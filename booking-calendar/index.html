<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dual Calendar with Actions</title>
  <style>
    :root {
      --primary: #4F46E5;
      --accent: #FBBF24;
      --background: #F9FAFB;
      --text: #111827;
      --disabled: #D1D5DB;
      --today: #3B82F6;
      --selected: #8B5CF6;
      --weekend-bg: #FEF2F2;
      --green: #10B981;
      --green-dark: #047857;
      --red: #EF4444;
      --blue: #3B82F6;
      --grey: #6B7280;
      --violet: #8B5CF6;
      --yellow: #F59E0B;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--background);
      color: var(--text);
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      min-height: 100vh;
    }

    .side {
      flex: 1 1 100%;
      padding: 1.5rem;
      box-sizing: border-box;
      text-align: center;
    }

    @media (min-width: 768px) {
      .side {
        flex: 1 1 50%;
        border-right: 1px solid #e5e7eb;
      }

      .side:last-child {
        border-right: none;
      }
    }

    .title {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      font-weight: 600;
      text-align: center;
    }

    .calendar {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      max-width: 400px;
      margin: 0 auto 1rem auto;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .calendar-header button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .calendar-header button:disabled {
      background: var(--disabled);
      cursor: not-allowed;
    }

    .calendar-header div {
      font-weight: 600;
      font-size: 1rem;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.4rem;
    }

    .day-name {
      text-align: center;
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--text); /* Default to dark color for all day names */
    }

    .day-name.weekend-text {
      color: var(--red); /* Override for weekend day names */
    }

    .day {
      text-align: center;
      padding: 0.6rem;
      border-radius: 8px;
      cursor: pointer;
      background: var(--background);
      font-weight: 500;
    }

    .day:hover {
      background: #e5e7eb;
    }

    .today {
      background: var(--today);
      color: white;
      font-weight: bold;
    }

    .selected {
      background: var(--selected);
      color: white;
    }

    /* New rule for red weekend day numbers */
    .day.weekend-day-number {
      color: var(--red);
    }

    /* Ensure selected and disabled states override the red weekend number */
    .day.selected.weekend-day-number,
    .day.selected {
      color: white; /* Selected days always white text */
    }

    .day.disabled.weekend-day-number,
    .day.disabled {
      color: #9ca3af; /* Disabled days always grey text */
    }

    .weekend {
      background-color: var(--weekend-bg);
    }

    .weekend:hover {
      background-color: #fbd5d5;
    }

    .day.next-month-day {
        color: var(--disabled);
        background: #F4F5F7;
    }

    .weekend.selected {
        background-color: var(--selected);
        color: white;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.4rem;
    }

    .buttons button {
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 6px;
      font-size: 0.85rem;
      color: white;
      cursor: pointer;
    }

    .btn-yellow { background-color: var(--accent); }
    .btn-blue { background-color: var(--blue); }
    .btn-green { background-color: var(--green); }
    .btn-grey { background-color: var(--grey); }
    .btn-red { background-color: var(--red); }
    .btn-violet { background-color: var(--violet); }
    .btn-green-dark { background-color: var(--green-dark); }
    .btn-yellow { background-color: var(--yellow); }

    /* New styles for date range inputs */
    .date-range-controls {
        margin-top: 1rem;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.5rem;
        align-items: center;
        padding: 0.5rem;
        border-radius: 8px;
        background-color: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
    }

    .date-range-controls label {
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text);
    }

    .date-range-controls input[type="date"] {
        padding: 0.4rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.9rem;
        color: var(--text);
        flex-grow: 1; /* Allow inputs to grow */
        max-width: 150px; /* Max width for inputs */
    }

    .date-range-controls button {
        padding: 0.4rem 0.8rem;
        border: none;
        border-radius: 6px;
        font-size: 0.85rem;
        color: white;
        cursor: pointer;
        background-color: var(--blue); /* Using existing blue for apply button */
    }
  </style>
</head>
<body>

<div class="container">
  <div class="side">
    <div class="title">General</div>
    <div class="calendar" id="calendar-left"></div>
    <div class="buttons">
      <button class="btn-yellow">Calculate Price</button>
      <button class="btn-blue">Book Reservation</button>
      <button class="btn-green">Show Available Dates and Times</button>
      <button class="btn-grey" id="reset-left">Reset Selection</button>
    </div>
    <div class="date-range-controls">
        <label for="start-date-left">From:</label>
        <input type="date" id="start-date-left">
        <label for="end-date-left">To:</label>
        <input type="date" id="end-date-left">
        <button id="apply-range-left">Apply Range</button>
    </div>
  </div>
  <div class="side">
    <div class="title">Service Providers</div>
    <div class="calendar" id="calendar-right"></div>
    <div class="buttons">
      <button class="btn-green">Enable</button>
      <button class="btn-grey">Disable</button>
      <button class="btn-blue">Edit</button>
      <button class="btn-red">Delete</button>
      <button class="btn-violet">Cancel</button>
      <button class="btn-green-dark">Accept</button>
      <button class="btn-yellow">Busy</button>
    </div>
    <div class="date-range-controls">
        <label for="start-date-right">From:</label>
        <input type="date" id="start-date-right">
        <label for="end-date-right">To:</label>
        <input type="date" id="end-date-right">
        <button id="apply-range-right">Apply Range</button>
    </div>
  </div>
</div>

<script>
  // Utility function to format dates as YYYY-MM-DD
  function getFormattedDate(date) {
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    return `${year}-${month}-${day}`;
  }

  class Calendar {
    constructor(containerId, startDateInputId, endDateInputId, applyButtonId) {
      this.container = document.getElementById(containerId);
      this.startDateInput = document.getElementById(startDateInputId);
      this.endDateInput = document.getElementById(endDateInputId);
      this.applyButton = document.getElementById(applyButtonId);

      this.currentDate = new Date(); // Each calendar has its own date
      this.selectedDates = new Set(); // Each calendar has its own set of selected dates

      this.render(); // Initial render
      this.addRangeInputListeners(); // Add listeners for the new range inputs
    }

    render() {
      const now = new Date();
      const currentYear = now.getFullYear();
      const currentMonth = now.getMonth();
      const currentDay = now.getDate();

      const year = this.currentDate.getFullYear();
      const month = this.currentDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();

      let startDay = (firstDay.getDay() + 6) % 7; // Adjust to make Monday the first day (0-6 -> Mon-Sun)

      this.container.innerHTML = `
        <div class="calendar-header">
          <button class="prev">&lt;</button>
          <div>${this.currentDate.toLocaleString('default', { month: 'long' })} ${year}</div>
          <button class="next">&gt;</button>
        </div>
        <div class="calendar-grid"></div>
      `;

      const grid = this.container.querySelector(".calendar-grid");
      const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
      dayNames.forEach((d, index) => {
        const el = document.createElement('div');
        el.className = 'day-name';
        if (index === 5 || index === 6) { // Saturday (5) and Sunday (6)
          el.classList.add('weekend-text');
        }
        el.textContent = d;
        grid.appendChild(el);
      });

      // Fill leading empty days
      for (let i = 0; i < startDay; i++) {
        const empty = document.createElement('div');
        grid.appendChild(empty);
      }

      // Render days of the current month
      for (let day = 1; day <= daysInMonth; day++) {
        const el = document.createElement('div');
        el.className = 'day';
        el.textContent = day;

        const cellDate = new Date(year, month, day);
        const cellDayOfWeek = (cellDate.getDay() + 6) % 7; // 0=Mon, 1=Tue, ..., 5=Sat, 6=Sun
        // Set hours to 00:00:00 to compare dates consistently without time component issues
        const isPast = cellDate.setHours(0, 0, 0, 0) < now.setHours(0, 0, 0, 0);
        const formattedCellDate = getFormattedDate(cellDate);

        if (cellDayOfWeek === 5 || cellDayOfWeek === 6) { // Saturday or Sunday
          el.classList.add('weekend', 'weekend-day-number'); // Add weekend-day-number for red text
        }

        if (isPast) {
          el.classList.add('disabled');
        } else {
          el.addEventListener('click', () => {
            if (this.selectedDates.has(formattedCellDate)) {
              this.selectedDates.delete(formattedCellDate);
            } else {
              this.selectedDates.add(formattedCellDate);
            }
            this.render(); // Re-render to reflect selection changes
          });
        }

        if (
          day === currentDay &&
          month === currentMonth &&
          year === currentYear
        ) {
          el.classList.add('today');
        }

        // Check if this day is selected for THIS calendar
        if (this.selectedDates.has(formattedCellDate)) {
          el.classList.add('selected');
        }

        grid.appendChild(el);
      }

      // Add days from the next month to fill the grid
      const totalDaysDisplayed = startDay + daysInMonth;
      let fillerDayCount = 0;

      // Ensure we fill to at least 5 rows (35 cells) and up to 6 rows (42 cells)
      if (totalDaysDisplayed < 35) {
          fillerDayCount = 35 - totalDaysDisplayed;
      } else if (totalDaysDisplayed < 42) {
          fillerDayCount = 42 - totalDaysDisplayed;
      }

      for (let day = 1; day <= fillerDayCount; day++) {
          const el = document.createElement('div');
          el.className = 'day next-month-day';
          el.textContent = day;

          const nextMonthDate = new Date(year, month + 1, day);
          const formattedNextMonthDate = getFormattedDate(nextMonthDate);
          const cellDayOfWeek = (nextMonthDate.getDay() + 6) % 7; // Get day of week for next month's day

          if (cellDayOfWeek === 5 || cellDayOfWeek === 6) { // Saturday or Sunday in the next month
            el.classList.add('weekend', 'weekend-day-number'); // Add weekend-day-number for red text
          }

          el.addEventListener('click', () => {
              this.currentDate = new Date(nextMonthDate); // Set the calendar's current date to the clicked next month day (new Date to avoid mutation)
              // Toggle selection for the clicked day in the next month for THIS calendar
              if (this.selectedDates.has(formattedNextMonthDate)) {
                this.selectedDates.delete(formattedNextMonthDate);
              } else {
                this.selectedDates.add(formattedNextMonthDate);
              }
              this.render(); // Re-render this calendar
          });

          // Check if this next month day is selected for THIS calendar
          if (this.selectedDates.has(formattedNextMonthDate)) {
            el.classList.add('selected');
          }

          grid.appendChild(el);
      }

      // After rendering the new buttons, attach their event listeners
      this.addEventListeners();

      // Disable previous button if at current month
      const prevButton = this.container.querySelector('.prev');
      if (this.currentDate.getFullYear() === now.getFullYear() && this.currentDate.getMonth() === now.getMonth()) {
        prevButton.disabled = true;
      } else {
        prevButton.disabled = false;
      }
    }

    addEventListeners() {
      // Remove any existing listeners first to prevent duplicates by cloning nodes
      const prevButton = this.container.querySelector('.prev');
      const nextButton = this.container.querySelector('.next');

      const newPrevButton = prevButton.cloneNode(true);
      const newNextButton = nextButton.cloneNode(true);

      prevButton.parentNode.replaceChild(newPrevButton, prevButton);
      nextButton.parentNode.replaceChild(newNextButton, nextButton);

      // Re-attach event listeners to the new buttons
      newPrevButton.addEventListener('click', () => {
        const now = new Date();
        // Prevent going back before the current month
        if (this.currentDate.getFullYear() > now.getFullYear() ||
           (this.currentDate.getFullYear() === now.getFullYear() && this.currentDate.getMonth() > now.getMonth())) {
          this.currentDate.setMonth(this.currentDate.getMonth() - 1);
          this.render();
        }
      });

      newNextButton.addEventListener('click', () => {
        this.currentDate.setMonth(this.currentDate.getMonth() + 1);
        this.render();
      });
    }

    addRangeInputListeners() {
      if (this.applyButton) {
        this.applyButton.addEventListener('click', () => this.handleApplyRange());
      }
    }

    handleApplyRange() {
      const startDateStr = this.startDateInput.value;
      const endDateStr = this.endDateInput.value;

      if (!startDateStr || !endDateStr) {
        alert('Please select both start and end dates for the range.');
        return;
      }

      // Append 'T00:00:00' to ensure dates are parsed consistently at the start of the day
      const startDate = new Date(startDateStr + 'T00:00:00');
      const endDate = new Date(endDateStr + 'T00:00:00');

      if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
        alert('Invalid date format detected. Please use YYYY-MM-DD.');
        return;
      }

      if (endDate < startDate) {
        alert('End date cannot be before start date.');
        return;
      }

      this.applyDateRange(startDate, endDate);
    }

    applyDateRange(startDate, endDate) {
      this.selectedDates.clear(); // Clear existing selections

      let loopDate = new Date(startDate);
      // Loop through each day from start to end, inclusive
      while (loopDate <= endDate) {
        this.selectedDates.add(getFormattedDate(loopDate));
        loopDate.setDate(loopDate.getDate() + 1); // Increment day
      }

      // Set the calendar view to the start month of the selected range
      this.currentDate = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
      this.render(); // Re-render the calendar to show the new selections and new month
    }

    resetSelection() {
      this.selectedDates.clear();
      this.render();
      // Also clear the date input fields
      if (this.startDateInput) this.startDateInput.value = '';
      if (this.endDateInput) this.endDateInput.value = '';
    }
  }

  // Initialize calendars with their respective input IDs
  const leftCalendar = new Calendar('calendar-left', 'start-date-left', 'end-date-left', 'apply-range-left');
  const rightCalendar = new Calendar('calendar-right', 'start-date-right', 'end-date-right', 'apply-range-right');

  // Add event listener for the "Reset Selection" button for the left calendar
  document.getElementById('reset-left').addEventListener('click', () => {
    leftCalendar.resetSelection();
  });
  // You can add a similar reset button for the right calendar if needed.

</script>

</body>
</html>